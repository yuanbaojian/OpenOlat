(function(a){a.extend(mejs.MepDefaults,{sourcechooserText:""});a.extend(MediaElementPlayer.prototype,{buildsourcechooser:function(h,j,e,d){var k=this,g=k.options.sourcechooserText?k.options.sourcechooserText:mejs.i18n.t("mejs.source-chooser"),c;h.sourcechooserButton=a('<div class="mejs-button mejs-sourcechooser-button"><button type="button" role="button" aria-haspopup="true" aria-owns="'+k.id+'" title="'+g+'" aria-label="'+g+'"></button><div class="mejs-sourcechooser-selector mejs-offscreen" role="menu" aria-expanded="false" aria-hidden="true"><ul></ul></div></div>').appendTo(j).hover(function(){clearTimeout(c);h.showSourcechooserSelector()},function(){var i=a(this);c=setTimeout(function(){h.hideSourcechooserSelector()},500)}).on("keydown",function(l){var i=l.keyCode;switch(i){case 32:if(!mejs.MediaFeatures.isFirefox){h.showSourcechooserSelector()}a(this).find(".mejs-sourcechooser-selector").find("input[type=radio]:checked").first().focus();break;case 13:h.showSourcechooserSelector();a(this).find(".mejs-sourcechooser-selector").find("input[type=radio]:checked").first().focus();break;case 27:h.hideSourcechooserSelector();a(this).find("button").focus();break;default:return true}}).on("focusout",mejs.Utility.debounce(function(i){setTimeout(function(){var l=a(document.activeElement).closest(".mejs-sourcechooser-selector");if(!l.length){h.hideSourcechooserSelector()}},0)},100)).delegate("input[type=radio]","click",function(){a(this).attr("aria-selected",true).attr("checked","checked");a(this).closest(".mejs-sourcechooser-selector").find("input[type=radio]").not(this).attr("aria-selected","false").removeAttr("checked");var n=this.value;if(d.currentSrc!=n){var m=d.currentTime;var l=d.paused;d.pause();d.setSrc(n);d.addEventListener("loadedmetadata",function(o){d.currentTime=m},true);var i=function(o){if(!l){d.play()}d.removeEventListener("canplay",i,true)};d.addEventListener("canplay",i,true);d.load()}}).delegate("button","click",function(i){if(a(this).siblings(".mejs-sourcechooser-selector").hasClass("mejs-offscreen")){h.showSourcechooserSelector();a(this).siblings(".mejs-sourcechooser-selector").find("input[type=radio]:checked").first().focus()}else{h.hideSourcechooserSelector()}});for(var f in this.node.children){var b=this.node.children[f];if(b.nodeName==="SOURCE"&&(d.canPlayType(b.type)=="probably"||d.canPlayType(b.type)=="maybe")){h.addSourceButton(b.src,b.title,b.type,d.src==b.src)}}},addSourceButton:function(f,c,e,b){var d=this;if(c===""||c==undefined){c=f}e=e.split("/")[1];d.sourcechooserButton.find("ul").append(a('<li><input type="radio" name="'+d.id+'_sourcechooser" id="'+d.id+"_sourcechooser_"+c+e+'" role="menuitemradio" value="'+f+'" '+(b?'checked="checked"':"")+'aria-selected="'+b+'" /><label for="'+d.id+"_sourcechooser_"+c+e+'" aria-hidden="true">'+c+'<span class="type">('+e+")</span></label></li>"));d.adjustSourcechooserBox()},adjustSourcechooserBox:function(){var b=this;b.sourcechooserButton.find(".mejs-sourcechooser-selector").height(b.sourcechooserButton.find(".mejs-sourcechooser-selector ul").outerHeight(true))},hideSourcechooserSelector:function(){this.sourcechooserButton.find(".mejs-sourcechooser-selector").addClass("mejs-offscreen").attr("aria-expanded","false").attr("aria-hidden","true").find("input[type=radio]").attr("tabindex","-1")},showSourcechooserSelector:function(){this.sourcechooserButton.find(".mejs-sourcechooser-selector").removeClass("mejs-offscreen").attr("aria-expanded","true").attr("aria-hidden","false").find("input[type=radio]").attr("tabindex","0")}})})(mejs.$);