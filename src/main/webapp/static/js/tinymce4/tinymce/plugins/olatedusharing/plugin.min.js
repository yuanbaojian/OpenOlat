(function(){tinymce.create("org.olat.modules.edusharing.ui",{init:function(j,b){var f,g;var h;function k(){if(f){return f}var o=o_getMainWin();if(o){f=jQuery(document).ooTranslator().getTranslator(o.o_info.locale,"org.olat.modules.edusharing.ui")}else{f={translate:function(p){return p}}}return f}function e(){if(g){return g}var o=o_getMainWin();if(o){g=jQuery(document).ooTranslator().getTranslator(o.o_info.locale,"org.olat.core")}else{g={translate:function(p){return p}}}return g}function m(o){if(1!=o.nodeType){return false}if(!o.dataset.es_identifier){return false}return true}function n(){function o(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return o()+o()+o()+o()+o()+o()+o()+o()}function d(q){var p=j.getParam("contextPath");var o=p+"/edusharing/preview",o=o.concat("?objectUrl="+q.object_url);o=o.concat("&version="+q.window_version);return o}function l(p){var o=p!=null&&p.mimetype!==null?p.mimetype.substr(0,6).toLowerCase():null;if(p.mediatype=="tool_object"||o=="audio/"||o=="video/"||o=="image/"||p.repotype=="YOUTUBE"){return true}return false}function i(p){if(typeof p.target.params=="undefined"){console.warn("edu-sharing selection returns nothing.");return}if(typeof p.target.params.mimetype=="undefined"){return}var q=p.target.params;var o=j.selection.getNode();node=null;if(l(q)){node=document.createElement("img");node=o.appendChild(node);node.setAttribute("src",d(q))}else{node=document.createElement("a");node=o.appendChild(node);node.innerHTML=q.title}node.dataset.es_identifier=n();node.dataset.es_objecturl=q.object_url;node.dataset.es_version=q.window_version;node.dataset.es_version_current=q.window_version;if(q.es_mimetype!==null){node.dataset.es_mimetype=q.mimetype}if(q.mediatype!==null){node.dataset.es_mediatype=q.mediatype}if(q.window_width!==null){node.dataset.es_width=q.window_width}if(q.window_height!==null){node.dataset.es_height=q.window_height}node.dataset.es_first_edit=true;node.dataset.es_show_license="show";node.dataset.es_show_infos="show";node.setAttribute("class","o_edusharing_left");c(node,q);j.selection.setCursorLocation(node);j.execCommand("edusharing_edit_dialog")}function a(p){var q=p.data;var o=j.selection.getNode();c(o,q);if(q.window_versionshow=="latest"){o.dataset.es_version=0}else{o.dataset.es_version=o.dataset.es_version_current}o.dataset.es_show_license=q.esShowLicense;o.dataset.es_show_infos=q.esShowInfos;j.execCommand("mceRepaint")}function c(q,r){q.setAttribute("class",r.esFloat);q.setAttribute("alt",r.title);q.setAttribute("title",r.title);var p=r.window_width;if(p==0){p=""}q.setAttribute("width",p);var o=r.window_height;if(o==0){o=""}q.setAttribute("height",o)}j.addButton("olatedusharing",{title:"edu-sharing",image:b+"/img/edusharing.png",cmd:"edusharing_button",onPostRender:function(){var o=this;j.on("NodeChange",function(q){var p=m(j.selection.getNode());o.active(p)})}});j.addCommand("edusharing_button",function(q,p){var o=j.selection.getNode();if(o){if(m(o)){j.execCommand("edusharing_edit_dialog",q,p)}else{j.execCommand("edusharing_insert_dialog",q,p)}}});j.addCommand("edusharing_insert_dialog",function(){var o={url:j.getParam("contextPath")+"/edusharing/search",width:document.documentElement.clientWidth*0.8,height:document.documentElement.clientHeight*0.8,inline:1,maximizable:true,onClose:i};j.windowManager.open(o)});j.addCommand("edusharing_edit_dialog",function(r,q){var p=j.selection.getNode();if(!m(p)){return false}var t={window_width:p.getAttribute("width"),window_height:p.getAttribute("height"),title:p.getAttribute("title"),esFloat:p.getAttribute("class"),esShowLicense:p.dataset.es_show_license,esShowInfos:p.dataset.es_show_infos,window_versionshow:p.dataset.es_version==0?"latest":"current",mimetype:p.dataset.es_mimetype};var o=p.dataset.es_first_edit==="true"?false:true;p.dataset.es_first_edit=false;var s=!l(t);j.windowManager.open({title:k().translate("tiny.config.dialog.title"),body:[{type:"form",items:[{name:"title",type:"textbox",label:k().translate("tiny.config.title"),value:t.title},{name:"window_versionshow",type:"listbox",label:o?null:k().translate("tiny.config.version"),values:[{text:k().translate("tiny.config.version.latest"),value:"latest"},{text:k().translate("tiny.config.version.current"),value:"current"}],value:t.window_versionshow,hidden:o},{name:"esShowLicense",type:"listbox",label:k().translate("tiny.config.license.label"),values:[{text:k().translate("tiny.config.license.show"),value:"show"},{text:k().translate("tiny.config.license.hide"),value:"hide"}],value:t.esShowLicense},{name:"esShowInfos",type:"listbox",label:k().translate("tiny.config.infos.label"),values:[{text:k().translate("tiny.config.infos.show"),value:"show"},{text:k().translate("tiny.config.infos.hide"),value:"hide"}],value:t.esShowInfos},{name:"esFloat",type:"listbox",label:k().translate("tiny.config.float"),values:[{text:k().translate("tiny.config.float.left"),value:"o_edusharing_left"},{text:k().translate("tiny.config.float.right"),value:"o_edusharing_right"},{text:k().translate("tiny.config.float.inline"),value:"o_edusharing_inline"},{text:k().translate("tiny.config.float.none"),value:"o_edusharing_none"}],value:t.esFloat},{type:"container",label:s?null:k().translate("tiny.config.size"),layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"window_width",type:"textbox",value:t.window_width,maxLength:4,size:4},{type:"label",text:"x"},{name:"window_height",type:"textbox",value:t.window_height,maxLength:4,size:4}],hidden:s}]}],onSubmit:a},t)})},getInfo:function(){return{longname:"OpenOLAT edu-sharing",author:"uhensler, frentix GmbH",authorurl:"http://www.frentix.com",infourl:"http://www.frentix.com",version:"1.0.0"}}});tinymce.PluginManager.add("olatedusharing",org.olat.modules.edusharing.ui)})();