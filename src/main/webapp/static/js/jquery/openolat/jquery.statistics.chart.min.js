(function(d){d.fn.qtiStatistics=function(n,l){var m=d.extend({values:[],colors:[],cut:null,step:null,participants:-1,mapperUrl:"-",barHeight:40,xTopLegend:"x Top",xBottomLegend:"x Bottom",yLeftLegend:"y Left",yRightLegend:"y Right"},l);var k=this;e(k,n,m);jQuery(window).resize(function(){jQuery(k).empty();e(k,n,m)});return this};function e(n,l,k){try{if(l=="histogramScore"){h(n,k)}else{if(l=="histogramDuration"){a(n,k)}else{if(l=="horizontalBarSingleChoice"){b(n,k)}else{if(l=="rightAnswerPerItem"){j(n,k)}else{if(l=="averageScorePerItem"){g(n,k)}else{if(l=="horizontalBarMultipleChoice"){c(n,k)}else{if(l=="horizontalBarMultipleChoiceSurvey"){f(n,k)}else{if(l=="highScore"){i(n,k)}}}}}}}}}catch(m){if(window.console){console.log(m)}}}function g(k,o){var s=k.width();var q=o.values.reverse();var p={top:10,right:60,bottom:40,left:60},m=s-p.left-p.right;var w=q.length*o.barHeight;k.height(w+p.top+p.bottom+"px");var v=d3.scaleLinear().domain([0,d3.max(q,function(x){return x[1]})]).range([0,m]);var n=d3.axisBottom(v).ticks(10);var u=d3.scaleBand().domain(q.map(function(x){return x[0]})).rangeRound([w,0]);var l=d3.axisLeft(u);var r=d3.select("#"+k.attr("id")).append("svg").attr("width",m+p.left+p.right).attr("height",w+p.top+p.bottom).append("g").attr("transform","translate("+p.left+","+p.top+")");r.append("g").attr("class","x axis").attr("transform","translate(0,"+w+")").call(n).append("text").attr("y",(p.bottom/1.7)).attr("x",(m/2)).attr("dy","1em").attr("fill","#000").style("text-anchor","middle").text(o.xBottomLegend);r.selectAll(".bar0").data(q).enter().append("rect").attr("class","bar bar_default").attr("fill","bar_default").attr("x",0).attr("y",function(x){return u(x[0])+2}).attr("width",function(x){return v(x[1])}).attr("height",u.bandwidth()-4);var t=d3.format(".2");var z=((u.bandwidth()/2)+3)+"px";r.selectAll(".bar0").data(q).enter().append("text").attr("x",function(x){return v(x[1])}).attr("y",function(x){return u(x[0])+2}).attr("dx",-3).attr("dy",z).attr("text-anchor","end").attr("fill","rgb(48,48,48)").attr("stroke","none").text(function(x){return(x[1]<=0)?"":t(x[1])});r.append("g").attr("class","y axis").call(l).append("text").attr("transform","rotate(-90)").attr("y",0-(p.right/1.7)).attr("x",0-(w/2)).attr("dy","1em").attr("fill","#000").style("text-anchor","middle").text(o.yLeftLegend)}function j(l,p){var t=l.width();var r=p.values.reverse();var q={top:15,right:60,bottom:40,left:60},o=t-q.left-q.right;var z=r.length*p.barHeight;l.height(z+q.top+q.bottom+"px");var u=p.participants;var w=d3.scaleLinear().domain([0,u]).range([0,o]);var n=d3.scaleLinear().domain([0,1]).range([0,o]);var k=d3.axisBottom(n).ticks(10,"%");var v=d3.scaleBand().domain(r.map(function(x){return x[0]})).rangeRound([z,0]);var m=d3.axisLeft(v);var s=d3.select("#"+l.attr("id")).append("svg").attr("width",o+q.left+q.right).attr("height",z+q.top+q.bottom).append("g").attr("transform","translate("+q.left+","+q.top+")");s.append("g").attr("class","x axis").attr("transform","translate(0,"+z+")").call(k).append("text").attr("y",(q.bottom/1.7)).attr("x",(o/2)).attr("dy","1em").attr("fill","#000").style("text-anchor","middle").text(p.xTopLegend);s.selectAll(".bar0").data(r).enter().append("rect").attr("class","bar bar_green").attr("fill","bar_green").attr("x",0).attr("y",function(x){return v(x[0])+2}).attr("width",function(x){return w(x[1])}).attr("height",v.bandwidth()-4);var A=((v.bandwidth()/2)+3)+"px";s.selectAll(".bar0").data(r).enter().append("text").attr("x",function(x){return w(x[1])}).attr("y",function(x){return v(x[0])+2}).attr("dx",-3).attr("dy",A).attr("text-anchor","end").attr("fill","rgb(48,48,48)").attr("stroke","none").text(function(x){return(x[1]<=0)?"":x[1]});s.append("g").attr("class","y axis").call(m).append("text").attr("transform","rotate(-90)").attr("y",0-(q.right/1.7)).attr("x",0-(z/2)).attr("dy","1em").attr("fill","#000").style("text-anchor","middle").text(p.yLeftLegend)}function f(l,p){var t=l.width();var r=p.values.reverse();var q={top:40,right:15,bottom:40,left:40};var A=r.length*p.barHeight;l.height(A+q.top+q.bottom+"px");var o=t-q.left-q.right;var u=p.participants;var w=u;var z=d3.scaleLinear().domain([0,w]).range([0,o]);var n=d3.scaleLinear().domain([0,1]).range([0,o]);var k=d3.axisBottom(n).ticks(10,"%");var v=d3.scaleBand().domain(r.map(function(x){return x[0]})).rangeRound([A,0]);var m=d3.axisLeft(v);var s=d3.select("#"+l.attr("id")).append("svg").attr("width",o+q.left+q.right).attr("height",A+q.top+q.bottom).append("g").attr("transform","translate("+q.left+","+q.top+")");s.append("g").attr("class","x axis").attr("transform","translate(0,"+A+")").call(k).append("text").attr("y",(q.bottom/1.7)).attr("x",(o/2)).attr("dy","1em").attr("fill","#000").style("text-anchor","middle").text(p.xBottomLegend);s.append("g").attr("class","y axis").call(m).append("text").attr("transform","rotate(-90)").attr("y",0-q.left).attr("x",0-(A/2)).attr("dy","1em").attr("fill","#000").style("text-anchor","middle").text(p.yLeftLegend);s.selectAll(".bar0").data(r).enter().append("rect").attr("class","bar bar_default").attr("fill","bar_default").attr("x",0).attr("y",function(x){return v(x[0])+2}).attr("width",function(x){return z(x[1])}).attr("height",v.bandwidth()-4);var B=((v.bandwidth()/2)+3)+"px";s.selectAll(".bar0").data(r).enter().append("text").attr("x",function(x){return z(x[1])}).attr("y",function(x){return v(x[0])+2}).attr("dx",-3).attr("dy",B).attr("text-anchor","end").attr("fill","rgb(48,48,48)").attr("stroke","none").text(function(x){return(x[1]<=0)?"":x[1]})}function c(l,p){var t=l.width();var r=p.values.reverse();var q={top:40,right:15,bottom:40,left:40};var A=r.length*p.barHeight;l.height(A+q.top+q.bottom+"px");var o=t-q.left-q.right;var u=p.participants;var w=u;var z=d3.scaleLinear().domain([0,w]).range([0,o]);var n=d3.scaleLinear().domain([0,1]).range([0,o]);var k=d3.axisBottom(n).ticks(10,"%");var v=d3.scaleBand().domain(r.map(function(x){return x[0]})).rangeRound([A,0]);var m=d3.axisLeft(v);var s=d3.select("#"+l.attr("id")).append("svg").attr("width",o+q.left+q.right).attr("height",A+q.top+q.bottom).append("g").attr("transform","translate("+q.left+","+q.top+")");s.append("g").attr("class","x axis").attr("transform","translate(0,"+A+")").call(k).append("text").attr("y",(q.bottom/1.7)).attr("x",(o/2)).attr("dx","1em").attr("fill","#000").style("text-anchor","middle").text(p.xBottomlegend);s.append("g").attr("class","y axis").call(m).append("text").attr("transform","rotate(-90)").attr("y",0-q.left).attr("x",0-(A/2)).attr("dy","1em").attr("fill","#000").style("text-anchor","middle").text(p.yLeftLegend);s.selectAll(".bar0").data(r).enter().append("rect").attr("class","bar bar_green").attr("fill","bar_green").attr("x",0).attr("y",function(x){return v(x[0])+2}).attr("width",function(x){return z(x[1])}).attr("height",v.bandwidth()-4);var B=((v.bandwidth()/2)+3)+"px";s.selectAll(".bar0").data(r).enter().append("text").attr("x",function(x){return z(x[1])}).attr("y",function(x){return v(x[0])+2}).attr("dx",-3).attr("dy",B).attr("text-anchor","end").attr("fill","rgb(48,48,48)").attr("stroke","none").text(function(x){return(x[1]<=0)?"":x[1]});s.selectAll(".bar1").data(r).enter().append("rect").attr("class","bar bar_red").attr("fill","bar_red").attr("x",function(x){return z(x[1])}).attr("y",function(x){return v(x[0])+2}).attr("width",function(x){return z(x[2])}).attr("height",v.bandwidth()-4);s.selectAll(".bar1").data(r).enter().append("text").attr("x",function(x){return z(x[1]+x[2])}).attr("y",function(x){return v(x[0])+2}).attr("dx",-3).attr("dy",B).attr("text-anchor","end").attr("fill","rgb(48,48,48)").attr("stroke","none").text(function(x){return(x[2]<=0)?"":x[2]});s.selectAll(".bar2").data(r).enter().append("rect").attr("class","bar bar_grey").attr("fill","bar_grey").attr("x",function(x){return z(x[1]+x[2])}).attr("y",function(x){return v(x[0])+2}).attr("width",function(x){return z(x[3])}).attr("height",v.bandwidth()-4);s.selectAll(".bar2").data(r).enter().append("text").attr("x",function(x){return z(x[1]+x[2]+x[3])}).attr("y",function(x){return v(x[0])+2}).attr("dx",-3).attr("dy",B).attr("text-anchor","end").attr("fill","rgb(48,48,48)").attr("stroke","none").text(function(x){return(x[3]<=0)?"":x[3]})}function b(l,q){var u=l.width();var s=q.values.reverse();var m=q.colors.reverse();var r={top:15,right:15,bottom:40,left:40};var B=s.length*q.barHeight;l.height(B+r.top+r.bottom+"px");var p=u-r.left-r.right;var v=q.participants;var z=v;var A=d3.scaleLinear().domain([0,z]).range([0,p]);var o=d3.scaleLinear().domain([0,1]).range([0,p]);var k=d3.axisBottom(o).ticks(10,"%");var w=d3.scaleBand().domain(s.map(function(x){return x[0]})).rangeRound([B,0]);var n=d3.axisLeft(w);var t=d3.select("#"+l.attr("id")).append("svg").attr("width",p+r.left+r.right).attr("height",B+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")");t.append("g").attr("class","x axis").attr("transform","translate(0,"+B+")").call(k).append("text").attr("y",(r.bottom/1.7)).attr("x",(p/2)).attr("dy","1em").attr("fill","#000").style("text-anchor","middle").text(q.xBottomLegend);t.selectAll(".bar0").data(s).enter().append("rect").attr("class",function(y,x){if(m==null){return"bar bar0 bar_default"}else{if(m.length>x){return m[x]}else{return"bar bar0 bar_default"}}}).attr("fill","bar_green").attr("x",0).attr("y",function(x){return w(x[0])+2}).attr("width",function(x){return A(x[1])}).attr("height",w.bandwidth()-4);var C=((w.bandwidth()/2)+3)+"px";t.selectAll(".bar0").data(s).enter().append("text").attr("x",function(x){return A(x[1])}).attr("y",function(x){return w(x[0])+2}).attr("dx",-3).attr("dy",C).attr("text-anchor","end").attr("fill","rgb(48,48,48)").attr("stroke","none").text(function(x){return(x[1]<=0)?"":x[1]});t.append("g").attr("class","y axis").call(n).append("text").attr("transform","rotate(-90)").attr("y",0-r.left).attr("x",0-(B/2)).attr("dy","1em").attr("fill","#000").style("text-anchor","middle").text(q.yLeftLegend)}function a(E,D){var l=E.height();var B=E.width();var n=D.values;var G=d3.max(n,function(x){return x});var r=new Date(2012,0,1,0,0);var u=undefined;if(G<10){var H=d3.timeFormat("%M:%S:%L");u=function(x){return H(new Date(r.getTime()+(x*1000)))}}else{if(G<3600){var F=d3.timeFormat("%M:%S");u=function(x){return F(new Date(r.getTime()+(x*1000)))}}else{u=function(x){return Math.round(x/60)}}}var w={top:10,right:60,bottom:40,left:60},C=B-w.left-w.right,A=l-w.top-w.bottom;var q=(G*0.1);var v=d3.scaleLinear().domain([0,G+q]).range([0,C]);var I=d3.histogram().domain(v.domain()).thresholds(v.ticks())(n);var p=d3.sum(I,function(x){return x.length});var t=d3.scaleLinear().domain([0,d3.max(I,function(x){return x.length})]).range([A,0]);var o=d3.scaleLinear().domain([0,d3.max(I,function(x){return x.length/p})]).range([A,0]);var s=d3.axisBottom(v).tickFormat(u);var k=d3.axisRight(t).ticks(10);var m=d3.axisLeft(o).ticks(10,"%");var z=d3.select("#"+E.attr("id")).append("svg").attr("width",C+w.left+w.right).attr("height",A+w.top+w.bottom).append("g").attr("transform","translate("+w.left+","+w.top+")");z.selectAll(".bar").data(I).enter().append("g").attr("class","bar bar_default").attr("transform",function(x){return"translate("+v(x.x0)+","+t(x.length)+")"}).append("rect").attr("x",2).attr("width",function(J){var x=v(I[0].x1)-v(I[0].x0)-4;var y=v(J.x0);if(y+x>v(G+q)){x=x-(y+x-v(G+q))-2}return x}).attr("height",function(x){return A-t(x.length)});z.append("g").attr("class","y axis").call(m).append("text").attr("transform","rotate(-90)").attr("y",0-w.left).attr("x",0-(A/2)).attr("dy","1em").attr("fill","#000").style("text-anchor","middle").text(D.yLeftLegend);z.append("g").attr("class","x axis").attr("transform","translate(0,"+A+")").call(s).append("text").attr("y",(w.bottom/1.1)).attr("x",(C/2)).attr("dx","1em").attr("fill","#000").style("text-anchor","middle").text(D.xBottomLegend);z.append("g").attr("class","y axis").attr("transform","translate("+C+",0)").call(k).append("text").attr("transform","rotate(90)").attr("y",0-(w.right)).attr("x",(A/2)).attr("dy","1em").attr("fill","#000").style("text-anchor","middle").text(D.yRightLegend)}function h(C,B){var l=C.height();var z=C.width();var n=B.values;var u={top:10,right:60,bottom:40,left:60},A=z-u.left-u.right,w=l-u.top-u.bottom;var o=B.cut;var D=d3.max(n,function(x){return x});if(D<1){D=1}var F=(D*0.1);if(F<1){F=1}var t=d3.scaleLinear().domain([0,D+F]).range([0,A]);var E=D<15?t.ticks(D):t.ticks();var G=d3.histogram().domain(t.domain()).thresholds(E)(n);var q=d3.sum(G,function(x){return x.length});var s=d3.scaleLinear().domain([0,d3.max(G,function(x){return x.length})]).range([w,0]);var p=d3.scaleLinear().domain([0,d3.max(G,function(x){return x.length/q})]).range([w,0]);var r=d3.axisBottom(t);if(D<15){r=r.ticks(D)}else{r=r.ticks()}r=r.tickFormat(d3.format("d"));var k=d3.axisRight(s).ticks(10);var m=d3.axisLeft(p).ticks(10,"%");var v=d3.select("#"+C.attr("id")).append("svg").attr("width",A+u.left+u.right).attr("height",w+u.top+u.bottom).append("g").attr("transform","translate("+u.left+","+u.top+")");v.selectAll(".bar").data(G).enter().append("g").attr("class",function(y,x){if(o==null){return"bar bar_default"}else{if(G[x].x<o){return"bar bar_red"}else{return"bar bar_green"}}}).attr("transform",function(y){var x=t(y.x0)-2;return"translate("+x+","+s(y.length)+")"}).append("rect").attr("x",2).attr("width",function(H){var x=t(G[0].x1)-t(G[0].x0)-2;var y=t(H.x0);if(y+x>t(D+F)){x=x-(y+x-t(D+F))}return x}).attr("height",function(x){return w-s(x.length)});v.append("g").attr("class","y axis").call(m).append("text").attr("transform","rotate(-90)").attr("y",0-u.left).attr("x",0-(w/2)).attr("dy","1em").attr("fill","#000").style("text-anchor","middle").text(B.yLeftLegend);v.append("g").attr("class","x axis").attr("transform","translate(0,"+w+")").call(r).append("text").attr("y",(u.bottom/1.1)).attr("x",(A/2)).attr("dx","1em").attr("fill","#000").style("text-anchor","middle").text(B.xBottomLegend);v.append("g").attr("class","y axis").attr("transform","translate("+A+",0)").call(k).append("text").attr("transform","rotate(90)").attr("y",0-(u.right)).attr("x",(w/2)).attr("dy","1em").attr("fill","#000").style("text-anchor","middle").text(B.yRightLegend)}function i(I,H){var l=I.height();var B=I.width();var n=H.values;var w={top:20,right:60,bottom:40,left:60},D=B-w.left-w.right,A=l-w.top-w.bottom;var q=H.cut;var J=d3.max(n,function(x){return x});var C=d3.min(n,function(x){return x});var r=1;if(H.step!=null){r=H.step}var G=J+r;var F=C-r;var u=d3.scaleLinear().domain([F,G]).range([0,D]);var v=d3.range(F,G+r,r);var K=d3.histogram().thresholds(v)(n);var p=d3.sum(K,function(x){return x.length});var t=d3.scaleLinear().domain([0,d3.max(K,function(x){return x.length})]).range([A,0]);var o=d3.scaleLinear().domain([0,d3.max(K,function(x){return x.length/p})]).range([A,0]);var s=d3.axisBottom(u).tickValues(v).tickFormat(d3.format("d"));var k=d3.axisRight(t).ticks(10);var m=d3.axisLeft(o).ticks(10,"%");var z=d3.select("#"+I.attr("id")).append("svg").attr("width",D+w.left+w.right).attr("height",A+w.top+w.bottom).append("g").attr("transform","translate("+w.left+","+w.top+")");var E=d3.range(F,G+r,r);z.selectAll(".bar").data(K).enter().append("g").attr("class",function(y,x){if(q==null){return"o_empty"}else{if(K[x].x==q){return"o_myself"}else{return"o_other"}}}).attr("transform",function(x){return"translate("+u(x.x0)+","+t(x.length)+")"}).append("rect").attr("x",function(y,x){return -(D/E.length)/2}).attr("y",function(x){return A-t(x.length)}).attr("width",(D/v.length)).attr("height",function(x){return 0}).style("opacity",0).transition().delay(function(y,x){return x*200/(G-F)}).duration(800).attr("y",function(x){return 0}).attr("height",function(x){return A-t(x.length)}).style("opacity",1);z.append("g").attr("class","y axis").call(m).append("text").attr("transform","rotate(-90)").attr("y",0-w.left).attr("x",0-(A/2)).attr("dy","1em").attr("fill","#000").style("text-anchor","middle").text(H.yLeftLegend);z.append("g").attr("class","x axis").attr("transform","translate(0,"+A+")").call(s).append("text").attr("y",(w.bottom/1.1)).attr("x",(D/2)).attr("dx","1em").attr("fill","#000").style("text-anchor","middle").text(H.xBottomLegend);z.append("g").attr("class","y axis").attr("transform","translate("+D+",0)").call(k).append("text").attr("transform","rotate(90)").attr("y",0-(w.right)).attr("x",(A/2)).attr("dy","1em").attr("fill","#000").style("text-anchor","middle").text(H.yRightLegend)}}(jQuery));