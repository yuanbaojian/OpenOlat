(function(h){h.fn.timeline=function(x){var y=this.data("data-oo-timeline");if(typeof timeline==="undefined"){y=h.extend({parentContainerId:"",startTime:null,endTime:null,dateFormat:"%d.%m.%y",dateLabel:"Date",status:{draft:"Draft",published:"Published",inRevision:"In revision",closed:"Closed",deleted:"Deleted"},values:[]},x);this.data("data-oo-timeline",y);j(this,y);r(this,y);D(this,y);p(this,y)}return this};var w;var d=10;var q,n,l,b;var t,B,v;var i,A,z,c,a;var E;var u,g;var I,G;var s=(183*24*60*60*1000);var C=false;function j(J,x){C=false;var y=jQuery("#"+x.parentContainerId);y.prepend("<div class='o_timeline_up'><a href='javascript:;' onclick=''><i class='o_icon o_icon-lg o_icon o_icon_slide_up'> </i></a></div>");y.append("<div class='o_timeline_down'><a href='javascript:;' onclick=''><i class='o_icon o_icon-lg o_icon o_icon_slide_down'> </i></a></div>")}function r(N,K){this.parentContainer=jQuery("#"+K.parentContainerId);var M=parentContainer.width();N.width(M);var L=N.height();if(parentContainer.height()<500){L=500}N.height(L);I=K.values;g=K.endTime;u=K.startTime;G=K.status;t={top:10,right:60,bottom:40,left:80};B=M-t.left-t.right;v=L-t.top-t.bottom;var J=d3.timeFormat(K.dateFormat);E=function(O){return J(new Date(O))};q=d3.scaleLinear().domain([0,1]).range([0,B]);l=d3.axisBottom(q).ticks(0);var x=K.startTime==null?d3.min(I,function(O){return O.time}):K.startTime;var y=K.endTime==null?d3.max(I,function(O){return O.time}):K.endTime;n=d3.scaleLinear().domain([x,y]).range([v,0]);b=d3.axisLeft(n).ticks(5).tickFormat(E).tickSize(-B,5);w=d3.select("#"+N.attr("id")).append("svg").attr("width",B+t.left+t.right).attr("height",v+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")");A=d3.scaleLinear().domain([0,1]).range([0,B]);z=d3.scaleLinear().domain([0,d]).range([v,0]);a=d3.scaleLinear().domain([x,y]).range([0,d]);i=d3.line().x(function(O){return A(o(O.y))}).y(function(O){return z(O.y)}).curve(d3.curveLinear)}function p(y,x){jQuery("#"+x.parentContainerId+" .o_timeline_up a").on("click",function(){F()});jQuery("#"+x.parentContainerId+" .o_timeline_down a").on("click",function(){f()})}function F(){if(C){return}C=true;g=g+s;u=u+s;k(true)}function f(){if(C){return}C=true;g=g-s;u=u-s;k(false)}function k(x){try{a.domain([u,g]);n.domain([u,g]);e();m(x)}catch(y){if(window.console){console.log(y)}}}function e(){w.select(".y").call(b)}function m(x){var y=w.selectAll(".dot").data(I,H);y.transition().duration(1000).ease(d3.easeLinear).attrTween("cx",function(J){return function(K){var M=(1-K)*s;var L=x?(J.time+M):(J.time-M);return A(o(a(L)))}}).attr("cy",function(J){return n(J.time)}).on("end",function(){C=false})}function D(M,J){w.append("g").attr("class","x axis").attr("transform","translate(0,"+v+")").call(l);w.append("g").attr("class","y axis").call(b).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").attr("dx","-.71em").style("text-anchor","end").text("Date");var L=[];for(var y=0;y<(d*20);y++){L.push({y:(y==0?0:y/20)})}var x=w.append("path").data([L]).attr("d",i).attr("class","o_timeline_curve");var K=w.selectAll(".dot").data(I,H);K.enter().append("g").append("circle").attr("r",function(N){return(7+Math.floor(Math.random()*5))}).attr("id",H).attr("class",function(N){return"dot o_pf_status_"+N.status}).attr("cx",function(N){return A(o(a(N.time)))}).attr("cy",function(N){return n(N.time)});jQuery("g .dot").tooltip({html:true,container:"body",title:function(){var Q=jQuery(this).attr("id");var P;for(var O=I.length;O-->0;){if(Q==I[O].id){P=I[O]}}var N=G[P.status];return"<p>"+P.title+"<br>Status: "+N+"</p>"}});K.exit()}function H(x){return x.id}function o(x){return(1.5+Math.sin(x*1.1))/3}}(jQuery));